#include <nrfx.h>

// See https://github.com/SaitoYutaka/microbit_image_generator
static const uint32_t ascii_table[] = 
{
    0b0000000000000000000000000, // blank
    0b0101000000001001000101110, // 
    0b0101000000000000111010001, // 
    0b1101111111111110111000100, // 
    0b0000000000000000000000000, // blank
    0b0100010100010001110000000, // 
    0b0010001110011100010001110, // 
    0b1110011100111000000000000, // 
    0b0000000000000000000000000, // blank
    0b0100010100010000000000000, // 
    0b0000000000000000000000000, // blank
    0b0111100111111111010111100, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b1111001010010100101010100, // 
    0b1010101110110110111010101, // 
    0b0010000110001110011000100, // 
    0b0010001100111000110000100, // 
    0b0010001110001000111000100, // 
    0b0101001010010100000001010, // 
    0b0011011010010100101001010, // 
    0b0000000000000000000000000, // 
    0b1111111111000000000000000, // 
    0b0000000000000000000000000, // blank
    0b0010001110101010010000100, // 
    0b0010000100101010111000100, // 
    0b0010000010111110001000100, // 
    0b0010001000111110100000100, // 
    0b1000010000111100000000000, // 
    0b0000000000000000000000000, // blank
    0b0010001110111110000000000, // 
    0b1111101110001000000000000, // 
    0b0000000000000000000000000, // 
    0b0010000100001000000000100, //  !
    0b1010010100000000000000000, //  "
    0b0101011111010101111101010, //  #
    0b1111110100111110010111111, //  $
    0b1000100010001000100010001, //  %
    0b0110010010011011001001101, //  &
    0b0100010000000000000000000, //  '
    0b0001000100001000010000010, //  (
    0b0100000100001000010001000, //  )
    0b1010101110111110111010101, //  *
    0b0100011100010000000000000, //  +
    0b0100010000000000000000000, //  
    0b1110000000000000000000000, //  -
    0b1000000000000000000000000, //  .
    0b0001000100001000010001000, //  /
    0b0111010011101011100101110, //  0
    0b0010001100001000010001110, //  1
    0b0111000010011100100001110, //  2
    0b0111000010001100001001110, //  3
    0b0100001000010100111000010, //  4
    0b0111001000011100001001110, //  5
    0b0110001000011100101001110, //  6
    0b0111000010001100001000010, //  7
    0b0111001010011100101001110, //  8
    0b0111001010011100001001110, //  9
    0b1000000000100000000000000, //  :
    0b0100000000010001000000000, //  ;
    0b0001000100010000010000010, //  <
    0b1110000000111000000000000, //  =
    0b0100000100000100010001000, //  >
    0b0111010001001100000000100, //  ?
    0b0111010010101001000001110, //  @
    0b0110010010100011111110001, //  A
    0b1110010010111101000111110, //  B
    0b0111010001100001000101110, //  C
    0b1111010001100011000111110, //  D
    0b1111110000111101000011111, //  E
    0b1111110000111101000010000, //  F
    0b0111010000100111000101110, //  G
    0b1000110001111111000110001, //  H
    0b0111000100001000010001110, //  I
    0b0011000010000100101001110, //  J
    0b1001010100110001010010010, //  K
    0b1000010000100001000011110, //  L
    0b1000111011101011000110001, //  M
    0b1000111001101011001110001, //  N
    0b0111010001100011000101110, //  O
    0b1110010010111001000010000, //  P
    0b0111010001100011001101111, //  Q
    0b1110010010111001010010010, //  R
    0b0111110000011100000111110, //  S
    0b1111100100001000010000100, //  T
    0b1000110001100011000101110, //  U
    0b0101001010010100101000100, //  V
    0b1000110001101011010101010, //  W
    0b1000101010001000101010001, //  X
    0b1000101010001000010000100, //  Y
    0b1111100010001000100011111, //  Z
    0b0011000100001000010000110, //  [
    0b0100000100001000010000010, //  "\"
    0b0110000100001000010001100, //  ]
    0b0100010100000000000000000, //  ^
    0b1110000000000000000000000, //  _
    0b1000001000000000000000000, //  `
    0b0110010010100011111110001, //  a
    0b1110010010111101000111110, //  b
    0b0111010001100001000101110, //  c
    0b1111010001100011000111110, //  d
    0b1111110000111101000011111, //  e
    0b1111110000111101000010000, //  f
    0b0111010000100111000101110, //  g
    0b1000110001111111000110001, //  h
    0b0111000100001000010001110, //  i
    0b0011000010000100101001110, //  j
    0b0100101010011000101001001, //  k
    0b1000010000100001000011110, //  l
    0b1000111011101011000110001, //  m
    0b1000111001101011001110001, //  n
    0b0111010001100011000101110, //  o
    0b1110010010111001000010000, //  p
    0b0111010001100011001101111, //  q
    0b1110010010111001010010010, //  r
    0b0111110000011100000111110, //  s
    0b1111100100001000010000100, //  t
    0b1000110001100011000101110, //  u
    0b0101001010010100101000100, //  v
    0b1000110001101011010101010, //  w
    0b1000101010001000101010001, //  x
    0b1000101010001000010000100, //  y
    0b1111100010001000100011111, //  z
    0b0011000100010000010000110, //  {
    0b0010000100001000010000100, //  |
    0b0110000100000100010001100, //  }
    0b0101010100000000000000000, //  ~
    0b0100010100101001110000000, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0010000000001000010000100, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0010001001100100100100100, // 
    0b1110000100001000000000000, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0010001110001000000001110, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b1000000000000000000000000, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0010010010010011001000100, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0010000000011001000101110, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0101000000011100101001111, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0101000000011100101001110, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0101000000010100101001110, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0110010010101101000110110, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0101000000011100101001111, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0101000000011100101001110, // 
    0b0010000000011100000000100, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0101000000010100101001110, // 
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
    0b0000000000000000000000000, // blank
};

#define ROW3 (1<<15)
#define ROW2 (1<<14)
#define ROW1 (1<<13)
#define COL9 (1<<12)
#define COL8 (1<<11)
#define COL7 (1<<10)
#define COL6 (1<<9)
#define COL5 (1<<8)
#define COL4 (1<<7)
#define COL3 (1<<6)
#define COL2 (1<<5)
#define COL1 (1<<4)
#define ALL_LEDS (ROW3 | ROW2 | ROW1 | COL9 | COL8 | COL7 | COL6 | COL5 | COL4 | COL3 | COL2 | COL1)
#define ALL_COLS (COL9 | COL8 | COL7 | COL6 | COL5 | COL4 | COL3 | COL2 | COL1)
#define ALL_ROWS (ROW3 | ROW2 | ROW1)

static void getledinfo(uint32_t data, uint32_t * led1, uint32_t * led2, uint32_t * led3){
  uint32_t led_row1 = 0x0;
  uint32_t led_row2 = 0x0;
  uint32_t led_row3 = 0x0;
  
  if(data & 0b1000000000000000000000000) led_row1 |= COL1; // [R1/C1]
  if(data & 0b0100000000000000000000000) led_row2 |= COL4; // [R2/C4]
  if(data & 0b0010000000000000000000000) led_row1 |= COL2; // [R1/C2]
  if(data & 0b0001000000000000000000000) led_row2 |= COL5; // [R2/C5]
  if(data & 0b0000100000000000000000000) led_row1 |= COL3; // [R1/C3]
  if(data & 0b0000010000000000000000000) led_row3 |= COL4; // [R3/C4]
  if(data & 0b0000001000000000000000000) led_row3 |= COL5; // [R3/C5]
  if(data & 0b0000000100000000000000000) led_row3 |= COL6; // [R3/C6]
  if(data & 0b0000000010000000000000000) led_row3 |= COL7; // [R3/C7]
  if(data & 0b0000000001000000000000000) led_row3 |= COL8; // [R3/C8]
  if(data & 0b0000000000100000000000000) led_row2 |= COL2; // [R2/C2]
  if(data & 0b0000000000010000000000000) led_row1 |= COL9; // [R1/C9]
  if(data & 0b0000000000001000000000000) led_row2 |= COL3; // [R2/C3]
  if(data & 0b0000000000000100000000000) led_row3 |= COL9; // [R3/C9]
  if(data & 0b0000000000000010000000000) led_row2 |= COL1; // [R2/C1]
  if(data & 0b0000000000000001000000000) led_row1 |= COL8; // [R1/C8]
  if(data & 0b0000000000000000100000000) led_row1 |= COL7; // [R1/C7]
  if(data & 0b0000000000000000010000000) led_row1 |= COL6; // [R1/C6]
  if(data & 0b0000000000000000001000000) led_row1 |= COL5; // [R1/C5]
  if(data & 0b0000000000000000000100000) led_row1 |= COL4; // [R1/C4]
  if(data & 0b0000000000000000000010000) led_row3 |= COL3; // [R3/C3]
  if(data & 0b0000000000000000000001000) led_row2 |= COL7; // [R2/C7]
  if(data & 0b0000000000000000000000100) led_row3 |= COL1; // [R3/C1]
  if(data & 0b0000000000000000000000010) led_row2 |= COL6; // [R2/C6]
  if(data & 0b0000000000000000000000001) led_row3 |= COL2; // [R3/C2]

  led_row1 |= ROW1;
  led_row2 |= ROW2;
  led_row3 |= ROW3;

  *led1 = led_row1;
  *led2 = led_row2;
  *led3 = led_row3;
}

void getledchar(char c, uint32_t * led1, uint32_t * led2, uint32_t * led3) {
  uint32_t led_row1 = 0x0;
  uint32_t led_row2 = 0x0;
  uint32_t led_row3 = 0x0;

  uint32_t led = ascii_table[(uint32_t)c];
  getledinfo(led, &led_row1, &led_row2, &led_row3);

  *led1 = led_row1;
  *led2 = led_row2;
  *led3 = led_row3;
}

void make_animation(char c, uint32_t n, uint32_t dir, uint32_t * led1, uint32_t * led2, uint32_t * led3) {

  uint32_t temp;
  uint32_t led = ascii_table[(uint32_t)c];
  uint32_t led_row1 = 0x0;
  uint32_t led_row2 = 0x0;
  uint32_t led_row3 = 0x0;

  switch(dir){
    case 0: // Horizontal
      switch(n){
        case 0: temp = ((led & 0b1000010000100001000010000) >> 4); break;
        case 1: temp = ((led & 0b1100011000110001100011000) >> 3); break;
        case 2: temp = ((led & 0b1110011100111001110011100) >> 2); break;
        case 3: temp = ((led & 0b1111011110111101111011110) >> 1); break;
        case 4: temp = led; break;
        case 5: temp = ((led & 0b0111101111011110111101111) << 1); break;
        case 6: temp = ((led & 0b0011100111001110011100111) << 2); break;
        case 7: temp = ((led & 0b0001100011000110001100011) << 3); break;
        case 8: temp = ((led & 0b0000100001000010000100001) << 4); break;
        default: break;
      }
      break;
    case 1: // Vertical
      switch(n){
        case 0: temp = (led >> 20); break;
        case 1: temp = (led >> 15); break;
        case 2: temp = (led >> 10); break;
        case 3: temp = (led >> 5);  break;
        case 4: temp =  led;        break;
        case 5: temp = (led << 5);  break;
        case 6: temp = (led << 10); break;
        case 7: temp = (led << 15); break;
        case 8: temp = (led << 20); break;
        default: break;
      }
      break;
      default: break;
  }


  getledinfo(temp, &led_row1, &led_row2, &led_row3);

  *led1 = led_row1;
  *led2 = led_row2;
  *led3 = led_row3;

  // switch(dir){
  //   case 0: // Horizontal
  //     scroll[0] = ((ascii_table[(uint32_t)c] & 0b1000010000100001000010000) >> 4);
  //     scroll[1] = ((ascii_table[(uint32_t)c] & 0b1100011000110001100011000) >> 3);
  //     scroll[2] = ((ascii_table[(uint32_t)c] & 0b1110011100111001110011100) >> 2);
  //     scroll[3] = ((ascii_table[(uint32_t)c] & 0b1111011110111101111011110) >> 1);
  //     scroll[4] =   ascii_table[(uint32_t)c]; // ((led & 0b1111111111111111111111111) >> 0);
  //     scroll[5] = ((ascii_table[(uint32_t)c] & 0b0111101111011110111101111) << 1);
  //     scroll[6] = ((ascii_table[(uint32_t)c] & 0b0011100111001110011100111) << 2);
  //     scroll[7] = ((ascii_table[(uint32_t)c] & 0b0001100011000110001100011) << 3);
  //     scroll[8] = ((ascii_table[(uint32_t)c] & 0b0000100001000010000100001) << 4);
  //     break;
  //   case 1: // Vertical
  //   default:
  //     scroll[0] = (ascii_table[(uint32_t)c] >> 20);
  //     scroll[1] = (ascii_table[(uint32_t)c] >> 15);
  //     scroll[2] = (ascii_table[(uint32_t)c] >> 10);
  //     scroll[3] = (ascii_table[(uint32_t)c] >> 5);
  //     scroll[4] =  ascii_table[(uint32_t)c]; // ((led & 0b1111111111111111111111111) >> 0);
  //     scroll[5] = (ascii_table[(uint32_t)c] << 5);
  //     scroll[6] = (ascii_table[(uint32_t)c] << 10);
  //     scroll[7] = (ascii_table[(uint32_t)c] << 15);
  //     scroll[8] = (ascii_table[(uint32_t)c] << 20);
  //     break;
  // }

  return;
}
